<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ایران وابی - بهترین کیفیت با بصرفه‌ترین قیمت</title>
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />

  <!-- Manifest -->
  <link rel="manifest" href="manifest.json" />

  <!-- Theme color for mobile status bar -->
  <meta name="theme-color" content="#d32f2f">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font/dist/font-face.css" rel="stylesheet" />
  <style>
    body { font-family: 'Vazir', sans-serif; background-color: #f8f9fa; margin: 0; padding: 0; }
    header { background: linear-gradient(90deg, #FF0000, #ffffff); color: #000; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; }
    .btn-login { background:#fff; color:#FF0000; border:none; border-radius:5px; }
    .btn-login:hover { background:#e6e6e6; }
    .sidebar { background:#fff; padding:1rem; border-radius:10px; box-shadow:0 0 10px rgba(255, 0, 0, 0.1); margin-bottom:1rem; }
    .product-card { background:#fff; border-radius:10px; padding:1rem; box-shadow:0 0 10px rgba(252, 1, 1, 0.1); margin-bottom:1rem; text-align:center; }
    .product-card img { max-width:100%; border-radius:10px; margin-bottom:.5rem; }
    .footer { background:#ff0000; color:#fff; padding:1rem 0; text-align:center; }
    .footer a { color:#fff; margin:0 1rem; text-decoration:none; }
    .footer a:hover { color:#ffd900; }
    #cartIcon { position: relative; margin-right: 1rem; font-size: 24px; cursor: pointer; }
    #cartCount { position: absolute; top: -8px; right: -10px; background: red; color: white; border-radius: 50%; padding: 2px 6px; font-size: 12px; }
  </style>
</head>
<body>

  <!-- Header -->
  <header>
    <h1>ایران وابی</h1>
    <button class="btn btn-login" data-bs-toggle="modal" data-bs-target="#loginModal">ورود / ثبت‌نام</button>
  </header>

  <!-- Main Content -->
  <div class="container-fluid mt-4">
    <div class="row">
      <!-- Sidebar Filters -->
      <div class="col-md-3">
        <div class="sidebar">
          <h5>فیلتر قیمت</h5>
          <input type="range" class="form-range mb-1" min="0" max="1000000" step="10000" id="priceRange" />
          <p>تا <span id="priceValue">1,000,000</span> تومان</p>
          <h5 class="mt-4">دسته‌بندی</h5>
          <div id="categoryFilters"></div>
          <h5 class="mt-4">برند</h5>
          <div id="brandFilters"></div>
        </div>
      </div>

      <!-- Products -->
      <div class="col-md-9">
        <div class="row" id="productContainer">
          <!-- کارت‌های محصولات اینجا خواهند آمد -->
        </div>
      </div>
    </div>
  </div>



  







  <!-- فرم ارسال تیکت با منوی بازشونده -->
<section class="form-section mb-4">
  <h4 class="mb-3 toggle-form" style="cursor: pointer;">
    <i class="bi bi-plus-circle me-1 toggle-icon"></i> ارسال تیکت
  </h4>
  <div class="form-content" style="display: none;">
    <form id="ticketForm">
      <div class="mb-3">
        <label for="nameInput" class="form-label">نام</label>
        <input type="text" class="form-control" id="nameInput" required>
      </div>
      <div class="mb-3">
        <label for="subjectInput" class="form-label">موضوع</label>
        <input type="text" class="form-control" id="subjectInput" required>
      </div>
      <div class="mb-3">
        <label for="messageInput" class="form-label">پیام</label>
        <textarea class="form-control" id="messageInput" rows="4" required></textarea>
      </div>
      <button type="submit" class="btn btn-primary"><i class="bi bi-send me-1"></i> ارسال تیکت</button>
    </form>
  </div>
</section>

<script>
  const toggleHeader = document.querySelector('.toggle-form');
  const formContent = document.querySelector('.form-content');
  const toggleIcon = document.querySelector('.toggle-icon');

  toggleHeader.addEventListener('click', () => {
    const isOpen = formContent.style.display === 'block';
    formContent.style.display = isOpen ? 'none' : 'block';
    toggleIcon.classList.toggle('bi-plus-circle', isOpen);
    toggleIcon.classList.toggle('bi-dash-circle', !isOpen);
  });
</script>



  <!-- Footer -->
  <footer class="footer mt-4">
    <a href="index.html">خانه</a>
    <a href="contact.html">تماس با ما</a>
    <a href="cart.html">🛒 سبد خرید</a>
    <a href="about-us.html">درباره ما</a>
  </footer>

<!-- Modal حرفه‌ای لاگین/ثبت‌نام -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title">ورود یا ثبت‌نام</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="بستن"></button>
      </div>
      <div class="modal-body">
        <ul class="nav nav-tabs mb-3" id="authTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#loginTab" type="button" role="tab">ورود</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#registerTab" type="button" role="tab">ثبت‌نام</button>
          </li>
        </ul>
        <div class="tab-content" id="authTabContent">
          <div class="tab-pane fade show active" id="loginTab" role="tabpanel">
            <form id="loginForm">
              <div class="mb-3">
                <label class="form-label">شماره موبایل</label>
                <input type="tel" id="loginMobile" class="form-control" required>
<div class="mb-3" id="adminPasswordGroup" style="display: none;">
  <label class="form-label">رمز عبور</label>
  <input type="password" id="adminPassword" class="form-control">
</div>

              </div>
              <button type="submit" class="btn btn-danger w-100">ورود</button>
            </form>
          </div>
          <div class="tab-pane fade" id="registerTab" role="tabpanel">
            <form id="registerForm">
              <div class="mb-3">
                <label class="form-label">نام و نام خانوادگی</label>
                <input type="text" id="regFullName" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">شماره موبایل</label>
                <input type="tel" id="regMobile" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">نام مغازه</label>
                <input type="text" id="regShop" class="form-control" required>
              </div>
              <div class="mb-3">
                <label class="form-label">آدرس مغازه</label>
                <textarea id="regAddress" class="form-control" required></textarea>
              </div>
              <div class="mb-3">
                <label class="form-label">نقش</label>
                <select id="regRole" class="form-select" required>
                  <option value="">انتخاب کنید</option>
                  <option value="retail">خرده فروش</option>
                  <option value="wholesale">عمده فروش</option>
                </select>
              </div>
              <button type="submit" class="btn btn-success w-100">ثبت‌نام</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Login ↔ Signup toggle
    const loginForm = 

document.getElementById("loginForm").addEventListener("submit", function(e) {
  e.preventDefault();
  const mobile = document.getElementById("loginMobile").value.trim();
  const adminMobile = "09127824705";
  const adminPassword = "Mm@09127824705m";

  if (mobile === adminMobile) {
    const passGroup = document.getElementById("adminPasswordGroup");
    passGroup.style.display = "block";

    const enteredPassword = document.getElementById("adminPassword").value.trim();
    if (enteredPassword === adminPassword) {
      localStorage.setItem("loggedInUser", JSON.stringify({ mobile: adminMobile }));
      alert("✅ ورود مدیر");
      window.location.href = "admin-dashboard.html";
    } else if (enteredPassword) {
      alert("❌ رمز عبور اشتباه است");
    }
  } else {
    const users = JSON.parse(localStorage.getItem("users")) || [];
    const user = users.find(u => u.mobile === mobile);
    if (!user) {
      alert("کاربری با این شماره یافت نشد");
      return;
    }
    localStorage.setItem("loggedInUser", JSON.stringify(user));
    alert("✅ ورود موفق بود");
    window.location.reload();
  }
});


    signupForm = document.getElementById("signup-form"),
    switchLink = document.getElementById("switchFormLink"),
    title = document.getElementById("modalTitle");
    switchLink.onclick = e => {
      e.preventDefault();
      if (loginForm.style.display !== "none") {
        loginForm.style.display = "none";
        signupForm.style.display = "block";
        title.innerText = "ثبت‌نام";
        switchLink.innerText = "حساب کاربری دارید؟ ورود کنید";
      } else {
        loginForm.style.display = "block";
        signupForm.style.display = "none";
        title.innerText = "ورود";
        switchLink.innerText = "ثبت نام نکرده‌اید؟ ثبت‌نام کنید";
      }
    };
    window.addEventListener('load', ()=> new bootstrap.Modal(document.getElementById('loginModal')).show());

    // بارگذاری داده‌ها از localStorage
    const products  = JSON.parse(localStorage.getItem('products'))   || [];
    const categories= JSON.parse(localStorage.getItem('categories')) || [];
    const brands    = JSON.parse(localStorage.getItem('brands'))     || [];

    // رندر فیلترهای دسته‌بندی
    const catDiv = document.getElementById('categoryFilters');
    categories.forEach(cat => {
      catDiv.innerHTML += `
        <div class="form-check mb-1">
          <input class="form-check-input" type="checkbox" value="${cat}" id="cat-${cat}">
          <label class="form-check-label" for="cat-${cat}">${cat}</label>
        </div>`;
    });
    // رندر فیلترهای برند
    const brDiv = document.getElementById('brandFilters');
    brands.forEach(br => {
      brDiv.innerHTML += `
        <div class="form-check mb-1">
          <input class="form-check-input" type="checkbox" value="${br}" id="br-${br}">
          <label class="form-check-label" for="br-${br}">${br}</label>
        </div>`;
    });

    // کنترل قیمت
    const priceRange = document.getElementById('priceRange'),
          priceValue = document.getElementById('priceValue');
    priceRange.oninput = ()=> priceValue.innerText = Number(priceRange.value).toLocaleString();

    // تابع رندر محصولات
    function render() {
  const cont = document.getElementById('productContainer');
  cont.innerHTML = '';
  const selCats = [...catDiv.querySelectorAll('input:checked')].map(i=>i.value);
  const selBrs  = [...brDiv.querySelectorAll('input:checked')].map(i=>i.value);
  const maxP    = +priceRange.value;
  const loggedInUser = JSON.parse(localStorage.getItem("loggedInUser"));

  products.forEach(p => {
    if ((selCats.length && !selCats.includes(p.category)) ||
        (selBrs.length && !selBrs.includes(p.brand)) ||
        (+p.retailPrice > maxP)) return;

    let price = "نامشخص";
    if (loggedInUser?.role === "retail") {
      price = Number(p.retailPrice).toLocaleString() + " تومان";
    } else if (loggedInUser?.role === "wholesale") {
      price = Number(p.wholesalePrice).toLocaleString() + " تومان";
    }

    cont.innerHTML += `
      <div class="col-md-4">
        <div class="product-card">
          <img src="${p.image||'placeholder.jpg'}" alt="${p.name}">
          <h5>${p.name}</h5>
          <p>قیمت: ${price}</p>
          <button class="btn btn-danger">افزودن به سبد خرید</button>
        </div>
      </div>`;
  });
}
  if (!cont.innerHTML) cont.innerHTML = `<p class="text-center w-100">هیچ محصولی یافت نشد.</p>`;
    

    // لیسنرها
    priceRange.addEventListener('input', render);
    catDiv.addEventListener('change', render);
    brDiv.addEventListener('change', render);

    // اجرای اولیه
    render();

// ورود و ذخیره کاربر وارد شده
loginForm.addEventListener('submit', function(e) {
  e.preventDefault();
  const mobile = document.getElementById("mobile").value.trim();
  const password = document.getElementById("password").value.trim();

  const users = JSON.parse(localStorage.getItem("users")) || [];
  const user = users.find(u => u.mobile === mobile && u.password === password);

  if (user) {
    localStorage.setItem("loggedInUser", JSON.stringify(user));
    alert("ورود موفق!");
    location.reload();
  } else {
    alert("نام کاربری یا رمز عبور اشتباه است");
  }
});

const header = document.querySelector("header");
const loggedInUser = JSON.parse(localStorage.getItem("loggedInUser"));
if (loggedInUser) {
  const roleLabel = loggedInUser.role === "retail" ? "مغازه‌دار" : "عمده‌فروش";
  header.innerHTML += `<span style="margin-right:1rem;">👤 نقش شما: ${roleLabel}</span>`;
}



    // ذخیره‌سازی کاربران در localStorage هنگام ثبت‌نام
signupForm.addEventListener('submit', function(e) {
  e.preventDefault();

  const shopName = signupForm.elements[0].value.trim();
  const shopAddress = signupForm.elements[1].value.trim();
  const mobile = signupForm.elements[2].value.trim();
  const password = signupForm.elements[3].value.trim();
  const role = signupForm.querySelector('input[name="userRole"]:checked')?.value;

  const fullName = "کاربر جدید";

  const users = JSON.parse(localStorage.getItem("users")) || [];
  users.push({ fullName, shopName, shopAddress, role, mobile, password });
  localStorage.setItem("users", JSON.stringify(users));

  alert("ثبت‌نام با موفقیت انجام شد!");
  document.getElementById('loginModal').querySelector('.btn-close').click();
});

</script>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js"></script>

<!-- اتصال پروژه -->
<script src="firebase.js"></script>

<!-- سیستم ورود و ثبت‌نام -->
<script src="login-register.js"></script>

  
</body>
</html>
